# æ•°æ®å­˜å‚¨æž¶æž„è®¾è®¡

## ä¸€ã€æ•°æ®ç±»åž‹åˆ†æž

### æ•°æ®åˆ†ç±»

æ ¹æ®ä½ çš„éœ€æ±‚ï¼Œæ•°æ®å¯ä»¥åˆ†ä¸ºä»¥ä¸‹å‡ ç±»ï¼š

1. **IoTå®žæ—¶æ•°æ®**ï¼šä¼ æ„Ÿå™¨æµå¼æ•°æ®
2. **åŽ†å²æ•°æ®**ï¼šå·¥è‰ºå¤„ç†åŽ†å²è®°å½•
3. **é…ç½®æ•°æ®**ï¼šå·¥è‰ºè§„èŒƒã€è§„åˆ™æ¨¡æ¿
4. **è¯·æ±‚æ—¥å¿—**ï¼šç”¨æˆ·è¯·æ±‚å’Œä»»åŠ¡æ‰§è¡Œè®°å½•
5. **è®¡ç®—ç»“æžœ**ï¼šæ£€éªŒæŠ¥å‘Šå’Œä¸­é—´ç»“æžœ

---

## äºŒã€æŽ¨èå­˜å‚¨æ–¹æ¡ˆ

### ðŸ“Š æž¶æž„æ€»è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  IoTå®žæ—¶æ•°æ®å±‚                                    â”‚
â”‚  Kafka / RabbitMQ / Redis Stream                â”‚
â”‚  - æµå¼ä¼ æ„Ÿå™¨æ•°æ®                                  â”‚
â”‚  - æ—¶åºæ•°æ®ç¼“å†²                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“ æ•°æ®è½åœ°
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åŽ†å²æ•°æ®å±‚ï¼ˆæ—¶åºæ•°æ®åº“ï¼‰                           â”‚
â”‚  InfluxDB / TimescaleDB / ClickHouse            â”‚
â”‚  - ä¼ æ„Ÿå™¨åŽ†å²æ•°æ®                                   â”‚
â”‚  - å·¥è‰ºæ‰¹æ¬¡å®Œæ•´æ•°æ®                                 â”‚
â”‚  - æŒ‰FOç³»åˆ—å·ç»„ç»‡                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é…ç½®æ•°æ®å±‚ï¼ˆå…³ç³»åž‹æ•°æ®åº“ï¼‰                         â”‚
â”‚  PostgreSQL / MySQL                              â”‚
â”‚  - å·¥è‰ºè§„èŒƒç¼–å†™çš„æŠ½è±¡                               â”‚
â”‚  - è§„åˆ™æ¨¡æ¿                                       â”‚
â”‚  - ç‰ˆæœ¬ç®¡ç†                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ä¸šåŠ¡æ•°æ®å±‚ï¼ˆå…³ç³»åž‹æ•°æ®åº“ï¼‰                         â”‚
â”‚  PostgreSQL / MySQL                              â”‚
â”‚  - å·¥è‰ºæ‰¹æ¬¡ä¿¡æ¯                                   â”‚
â”‚  - æ£€éªŒæŠ¥å‘Š                                       â”‚
â”‚  - è¯·æ±‚æ—¥å¿—                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ä¸‰ã€è¯¦ç»†å­˜å‚¨æ–¹æ¡ˆ

### 1. IoTå®žæ—¶æ•°æ® â†’ **Kafkaï¼ˆæŽ¨èï¼‰**

#### ä¸ºä»€ä¹ˆé€‰æ‹© Kafkaï¼Ÿ

**ç‰¹æ€§**ï¼š
- âœ… **é«˜åžåé‡**ï¼šæ”¯æŒç™¾ä¸‡çº§æ¶ˆæ¯/ç§’
- âœ… **æµå¼å¤„ç†**ï¼šå®žæ—¶æ•°æ®æµ
- âœ… **æŒä¹…åŒ–**ï¼šæ•°æ®ä¿ç•™ç­–ç•¥
- âœ… **åˆ†å¸ƒå¼**ï¼šæ”¯æŒé›†ç¾¤
- âœ… **è§£è€¦**ï¼šç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…è§£è€¦

**é€‚ç”¨åœºæ™¯**ï¼š
- IoTä¼ æ„Ÿå™¨å®žæ—¶æ•°æ®æµ
- æ•°æ®ç¼“å†²å’ŒæŒä¹…åŒ–
- å¤šä¸ªæ¶ˆè´¹è€…è®¢é˜…ï¼ˆå®žæ—¶ç›‘æŽ§ã€æ•°æ®å…¥åº“ã€å‘Šè­¦ç­‰ï¼‰

#### æ•°æ®ç»“æž„

```json
{
  "topic": "iot.sensors",
  "key": "FO-20250115-001",  // FOç³»åˆ—å·ä½œä¸ºåˆ†åŒºé”®
  "timestamp": "2025-01-15T10:00:00Z",
  "data": {
    "VPRB1": 25.6,   // è¢‹å†…åŽ‹
    "PRESS": 150.0,  // ç½åŽ‹
    "PTC10": 60.5,   // çƒ­ç”µå¶1
    "PTC11": 61.2,   // çƒ­ç”µå¶2
    "PTC23": 59.8,   // çƒ­ç”µå¶3
    "PTC24": 60.1    // çƒ­ç”µå¶4
  }
}
```

#### é…ç½®å»ºè®®

```yaml
# Kafkaé…ç½®
kafka:
  brokers: ["kafka1:9092", "kafka2:9092", "kafka3:9092"]
  topics:
    sensors: "iot.sensors"
    events: "iot.events"      # å·¥è‰ºäº‹ä»¶
  consumer:
    group_id: "oplib-analyzer"
    auto_offset_reset: "latest"
  producer:
    acks: "all"              # ç¡®ä¿æ•°æ®ä¸ä¸¢å¤±
    retries: 3
```

---

### 2. åŽ†å²æ•°æ® â†’ **InfluxDBï¼ˆæŽ¨èï¼‰**

#### ä¸ºä»€ä¹ˆé€‰æ‹© InfluxDBï¼Ÿ

**ç‰¹æ€§**ï¼š
- âœ… **æ—¶åºä¼˜åŒ–**ï¼šä¸“ä¸ºæ—¶åºæ•°æ®è®¾è®¡
- âœ… **æŸ¥è¯¢å¿«**ï¼šé«˜æ•ˆçš„æ—¶é—´èŒƒå›´æŸ¥è¯¢
- âœ… **åŽ‹ç¼©**ï¼šæ•°æ®åŽ‹ç¼©çŽ‡é«˜
- âœ… **Tagç´¢å¼•**ï¼šæ”¯æŒæ ‡ç­¾ï¼ˆFOç³»åˆ—å·ã€è§„èŒƒIDç­‰ï¼‰
- âœ… **ä¿ç•™ç­–ç•¥**ï¼šè‡ªåŠ¨æ•°æ®è¿‡æœŸ

**é€‚ç”¨åœºæ™¯**ï¼š
- ä¼ æ„Ÿå™¨åŽ†å²æ•°æ®
- æŒ‰FOç³»åˆ—å·æŸ¥è¯¢
- æ—¶é—´åºåˆ—åˆ†æž
- æ•°æ®å½’æ¡£

#### æ•°æ®ç»“æž„

```
measurement: sensor_data

tags:
  fo_series_id: "FO-20250115-001"
  specification_id: "cps7020-n-308-vacuum"
  material_code: "CMS-CP-308"
  sensor_type: "bag_pressure" | "curing_pressure" | "thermocouple"

fields:
  value: 25.6
  unit: "kPa"

time: 2025-01-15T10:00:00Z
```

#### æ•°æ®ç»„ç»‡

```sql
-- InfluxDBç¤ºä¾‹æŸ¥è¯¢
SELECT * FROM sensor_data 
WHERE fo_series_id = 'FO-20250115-001' 
  AND time >= '2025-01-15T10:00:00Z' 
  AND time <= '2025-01-15T18:00:00Z'
```

#### æ›¿ä»£æ–¹æ¡ˆ

| æ–¹æ¡ˆ | ä¼˜ç‚¹ | ç¼ºç‚¹ | é€‚ç”¨åœºæ™¯ |
|-----|------|------|---------|
| **InfluxDB** | æ—¶åºä¼˜åŒ–ï¼ŒæŸ¥è¯¢å¿« | å…³ç³»æŸ¥è¯¢å¼± | **ä¼ æ„Ÿå™¨æ—¶åºæ•°æ®** â­ |
| **TimescaleDB** | å…³ç³»åž‹+æ—¶åºï¼ŒSQLæ ‡å‡† | æ•°æ®é‡å¤§ä¼šå˜æ…¢ | éœ€è¦SQLå…¼å®¹ |
| **ClickHouse** | æŸ¥è¯¢æžå¿«ï¼Œåˆ†æžå¼º | è¿ç»´å¤æ‚ | å¤§æ•°æ®åˆ†æž |
| **PostgreSQL** | é€šç”¨ï¼Œæˆç†Ÿ | æ—¶åºæŸ¥è¯¢æ…¢ | å°æ•°æ®é‡ |

**æŽ¨è**ï¼š**InfluxDB**ï¼ˆä¸“ä¸ºæ—¶åºæ•°æ®è®¾è®¡ï¼‰

---

### 3. å·¥è‰ºè§„èŒƒé…ç½® â†’ **PostgreSQLï¼ˆæŽ¨èï¼‰**

#### ä¸ºä»€ä¹ˆé€‰æ‹© PostgreSQLï¼Ÿ

**ç‰¹æ€§**ï¼š
- âœ… **å…³ç³»åž‹**ï¼šè§„èŒƒçš„å±‚çº§å…³ç³»å’Œå¼•ç”¨å…³ç³»
- âœ… **ACID**ï¼šäº‹åŠ¡ä¿è¯
- âœ… **JSONæ”¯æŒ**ï¼šçµæ´»å­˜å‚¨è§„åˆ™é…ç½®
- âœ… **ç‰ˆæœ¬ç®¡ç†**ï¼šé€šè¿‡è¡¨ç»“æž„æ”¯æŒ
- âœ… **å…¨æ–‡æœç´¢**ï¼šè§„åˆ™æè¿°æœç´¢

**é€‚ç”¨åœºæ™¯**ï¼š
- å·¥è‰ºè§„èŒƒå®šä¹‰
- è§„åˆ™æ¨¡æ¿
- è§„èŒƒ-ææ–™å…³ç³»
- é…ç½®ç‰ˆæœ¬ç®¡ç†

#### æ•°æ®åº“è¡¨è®¾è®¡

```sql
-- 1. è§„èŒƒç´¢å¼•è¡¨
CREATE TABLE specifications (
    id SERIAL PRIMARY KEY,
    specification_id VARCHAR(100) UNIQUE NOT NULL,
    specification_name VARCHAR(200) NOT NULL,
    version VARCHAR(50) NOT NULL,
    process_type VARCHAR(50),  -- 'é€šå¤§æ°”' | 'å…¨ç¨‹æŠ½çœŸç©º'
    description TEXT,
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);

-- 2. ææ–™å…³ç³»è¡¨
CREATE TABLE specification_materials (
    id SERIAL PRIMARY KEY,
    specification_id VARCHAR(100) REFERENCES specifications(specification_id),
    material_code VARCHAR(50) NOT NULL,
    material_name VARCHAR(200),
    is_primary BOOLEAN DEFAULT FALSE,
    UNIQUE(specification_id, material_code)
);

-- 3. è§„èŒƒå‚æ•°è¡¨
CREATE TABLE specification_parameters (
    id SERIAL PRIMARY KEY,
    specification_id VARCHAR(100) REFERENCES specifications(specification_id),
    parameter_name VARCHAR(100) NOT NULL,
    parameter_type VARCHAR(50),  -- 'initial_bag_pressure', 'heating_pressure'ç­‰
    min_value DECIMAL(10,2),
    max_value DECIMAL(10,2),
    threshold DECIMAL(10,2),
    unit VARCHAR(20),
    description TEXT,
    UNIQUE(specification_id, parameter_name)
);

-- 4. è§„åˆ™è¡¨
CREATE TABLE rules (
    id SERIAL PRIMARY KEY,
    specification_id VARCHAR(100) REFERENCES specifications(specification_id),
    rule_id VARCHAR(100) NOT NULL,
    rule_name VARCHAR(200),
    description TEXT,
    calculation_id VARCHAR(100),  -- å¼•ç”¨calculationsè¡¨
    pattern VARCHAR(50),  -- 'lower_bound_check', 'range_check'ç­‰
    severity VARCHAR(20),  -- 'minor', 'major', 'critical'
    parameters JSONB,  -- çµæ´»å­˜å‚¨è§„åˆ™å‚æ•°
    stage_id VARCHAR(100),
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW(),
    UNIQUE(specification_id, rule_id)
);

-- 5. é˜¶æ®µè¡¨
CREATE TABLE stages (
    id SERIAL PRIMARY KEY,
    specification_id VARCHAR(100) REFERENCES specifications(specification_id),
    stage_id VARCHAR(100) NOT NULL,
    stage_name VARCHAR(200),
    description TEXT,
    rules JSONB,  -- è¯¥é˜¶æ®µçš„è§„åˆ™IDåˆ—è¡¨
    created_at TIMESTAMP DEFAULT NOW(),
    UNIQUE(specification_id, stage_id)
);

-- 6. æ¨¡æ¿è¡¨ï¼ˆå¯é€‰ï¼Œå¦‚æžœå®žçŽ°æ¨¡æ¿ç³»ç»Ÿï¼‰
CREATE TABLE rule_templates (
    id SERIAL PRIMARY KEY,
    template_category VARCHAR(50),  -- 'pressure', 'temperature', 'rate'
    template_name VARCHAR(100) NOT NULL,
    pattern VARCHAR(50),
    description_template TEXT,
    aggregate VARCHAR(50),  -- 'first', 'max', 'avg'
    severity VARCHAR(20),
    parameters_schema JSONB,  -- å‚æ•°ç»“æž„å®šä¹‰
    created_at TIMESTAMP DEFAULT NOW()
);
```

#### æ•°æ®æŸ¥è¯¢ç¤ºä¾‹

```sql
-- èŽ·å–è§„èŒƒçš„å®Œæ•´é…ç½®
SELECT 
    s.specification_id,
    s.specification_name,
    array_agg(DISTINCT sm.material_code) as materials,
    json_agg(DISTINCT sp.*) as parameters,
    json_agg(DISTINCT r.*) as rules,
    json_agg(DISTINCT st.*) as stages
FROM specifications s
LEFT JOIN specification_materials sm ON s.specification_id = sm.specification_id
LEFT JOIN specification_parameters sp ON s.specification_id = sp.specification_id
LEFT JOIN rules r ON s.specification_id = r.specification_id
LEFT JOIN stages st ON s.specification_id = st.specification_id
WHERE s.specification_id = 'cps7020-n-308-vacuum'
GROUP BY s.specification_id, s.specification_name;
```

---

### 4. è¯·æ±‚æ—¥å¿—å’Œä¸šåŠ¡æ•°æ® â†’ **PostgreSQLï¼ˆæŽ¨èï¼‰**

#### ä¸ºä»€ä¹ˆä¹Ÿéœ€è¦å…³ç³»æ•°æ®åº“ï¼Ÿ

**éœ€æ±‚**ï¼š
- å·¥è‰ºæ‰¹æ¬¡ä¿¡æ¯ï¼ˆFOç³»åˆ—å·ã€è§„èŒƒIDã€èµ·æ­¢æ—¶é—´ï¼‰
- æ£€éªŒæŠ¥å‘Šå­˜å‚¨
- è¯·æ±‚æ‰§è¡Œæ—¥å¿—
- ä»»åŠ¡çŠ¶æ€è¿½è¸ª

#### æ•°æ®åº“è¡¨è®¾è®¡

```sql
-- 1. å·¥è‰ºæ‰¹æ¬¡è¡¨
CREATE TABLE process_batches (
    id SERIAL PRIMARY KEY,
    fo_series_id VARCHAR(50) UNIQUE NOT NULL,
    specification_id VARCHAR(100) REFERENCES specifications(specification_id),
    material_code VARCHAR(50),
    process_start_time TIMESTAMP NOT NULL,
    process_end_time TIMESTAMP,
    status VARCHAR(50),  -- 'running', 'completed', 'failed'
    created_at TIMESTAMP DEFAULT NOW()
);

-- 2. æ£€éªŒæŠ¥å‘Šè¡¨
CREATE TABLE inspection_reports (
    id SERIAL PRIMARY KEY,
    fo_series_id VARCHAR(50) REFERENCES process_batches(fo_series_id),
    specification_id VARCHAR(100) NOT NULL,
    report_type VARCHAR(50),  -- 'rule_check', 'full_report'
    report_data JSONB NOT NULL,
    rule_results JSONB,  -- è§„åˆ™æ£€éªŒç»“æžœ
    summary JSONB,  -- æ‘˜è¦ä¿¡æ¯
    total_rules INT,
    passed_rules INT,
    failed_rules INT,
    created_at TIMESTAMP DEFAULT NOW()
);

-- 3. ä»»åŠ¡æ‰§è¡Œè¡¨ï¼ˆä»»åŠ¡ç®¡ç†ï¼‰
CREATE TABLE task_executions (
    id SERIAL PRIMARY KEY,
    task_id UUID UNIQUE NOT NULL,
    workflow_name VARCHAR(100) NOT NULL,
    fo_series_id VARCHAR(50),
    specification_id VARCHAR(100),
    status VARCHAR(50),  -- 'pending', 'running', 'completed', 'failed'
    input_data JSONB,  -- è¯·æ±‚è¾“å…¥
    output_data JSONB,  -- è¾“å‡ºç»“æžœ
    error_message TEXT,
    execution_time_ms INT,
    created_at TIMESTAMP DEFAULT NOW(),
    started_at TIMESTAMP,
    completed_at TIMESTAMP
);

-- 4. è§„åˆ™æ£€éªŒç»“æžœè¯¦æƒ…è¡¨
CREATE TABLE rule_results (
    id SERIAL PRIMARY KEY,
    report_id INT REFERENCES inspection_reports(id),
    fo_series_id VARCHAR(50) NOT NULL,
    rule_id VARCHAR(100) NOT NULL,
    rule_name VARCHAR(200),
    stage_id VARCHAR(100),
    status VARCHAR(20),  -- 'passed', 'failed', 'warning'
    severity VARCHAR(20),
    actual_value DECIMAL(10,2),
    expected_value DECIMAL(10,2),
    threshold DECIMAL(10,2),
    message TEXT,
    checked_at TIMESTAMP DEFAULT NOW()
);
```

#### æŸ¥è¯¢ç¤ºä¾‹

```sql
-- æŸ¥è¯¢æŸä¸ªæ‰¹æ¬¡çš„æ‰€æœ‰æ£€éªŒç»“æžœ
SELECT 
    rr.rule_name,
    rr.status,
    MI rr.severity,
    rr.actual_value,
    rr.expected_value,
    rr.message
FROM rule_results rr
WHERE rr.fo_series_id = 'FO-20250115-001'
ORDER BY rr.severity DESC, rr.rule_name;
```

---

### 5. è¿è¡Œæ—¶æ•°æ® â†’ **Redisï¼ˆæŽ¨èï¼‰**

#### ä¸ºä»€ä¹ˆéœ€è¦ Redisï¼Ÿ

**ç‰¹æ€§**ï¼š
- âœ… **å†…å­˜ç¼“å­˜**ï¼šå¿«é€Ÿè¯»å†™
- âœ… **è¿‡æœŸç­–ç•¥**ï¼šè‡ªåŠ¨æ¸…ç†
- âœ… **æ•°æ®ç»“æž„**ï¼šæ”¯æŒHashã€Listç­‰
- âœ… **å‘å¸ƒè®¢é˜…**ï¼šä»»åŠ¡çŠ¶æ€é€šçŸ¥

**é€‚ç”¨åœºæ™¯**ï¼š
- ä¼ æ„Ÿå™¨é…ç½®ç¼“å­˜ï¼ˆsensor_mappingï¼‰
- ç”¨æˆ·ä¼šè¯
- ä»»åŠ¡çŠ¶æ€
- çƒ­ç‚¹æ•°æ®ç¼“å­˜

#### ä½¿ç”¨ç¤ºä¾‹

```python
# ç¼“å­˜ä¼ æ„Ÿå™¨é…ç½®
redis.set(
    f"sensor_config:{fo_series_id}",
    json.dumps(sensor_mapping),
    ex=3600  # 1å°æ—¶è¿‡æœŸ
)

# ç¼“å­˜è§„èŒƒé…ç½®
redis.set(
    f"spec:{specification_id}",
    json.dumps(spec_config),
    ex=7200  # 2å°æ—¶è¿‡æœŸ
)

# ä»»åŠ¡çŠ¶æ€
redis.setex(
    f"task:{task_id}",
    3600,
    json.dumps({"status": "running", "progress": 50})
)
```

---

## å››ã€æ•°æ®æµè½¬è®¾è®¡

### å®Œæ•´æ•°æ®æµ

```
1. IoTæ•°æ®äº§ç”Ÿ
   â””â”€â”€ Kafka: iot.sensors topic

2. å®žæ—¶å¤„ç†ï¼ˆå¯é€‰ï¼‰
   â””â”€â”€ Kafka Consumer â†’ å®žæ—¶ç›‘æŽ§/å‘Šè­¦

3. æ•°æ®è½åœ°
   â””â”€â”€ Kafka â†’ InfluxDB
   â””â”€â”€ æŒ‰FOç³»åˆ—å·ç»„ç»‡

4. ç”¨æˆ·è¯·æ±‚æ£€éªŒ
   â”œâ”€â”€ æŸ¥è¯¢InfluxDBèŽ·å–ä¼ æ„Ÿå™¨åŽ†å²æ•°æ®
   â”œâ”€â”€ æŸ¥è¯¢PostgreSQLèŽ·å–è§„èŒƒé…ç½®
   â””â”€â”€ æ‰§è¡Œè§„åˆ™æ£€éªŒ

5. ç»“æžœå­˜å‚¨
   â”œâ”€â”€ PostgreSQL: æ£€éªŒæŠ¥å‘Š
   â”œâ”€â”€ PostgreSQL: è§„åˆ™ç»“æžœè¯¦æƒ…
   â””â”€â”€ Redis: ä»»åŠ¡çŠ¶æ€ç¼“å­˜

6. æŸ¥è¯¢å’Œå±•ç¤º
   â”œâ”€â”€ indented Reports API
   â”œâ”€â”€ åŽ†å²æ•°æ®æŸ¥è¯¢ï¼ˆInfluxDBï¼‰
   â””â”€â”€ è§„èŒƒé…ç½®æŸ¥è¯¢ï¼ˆPostgreSQLï¼‰
```

---

## äº”ã€æŽ¨èæŠ€æœ¯æ ˆ

### æœ€å°åŒ–æ–¹æ¡ˆï¼ˆèµ„æºæœ‰é™ï¼‰

```
IoTå®žæ—¶æ•°æ®: Kafka
åŽ†å²æ•°æ®: PostgreSQL + TimescaleDB æ‰©å±•
é…ç½®æ•°æ®: PostgreSQL
ä¸šåŠ¡æ•°æ®: PostgreSQL
ç¼“å­˜: Redis
```

### ç”Ÿäº§çŽ¯å¢ƒæ–¹æ¡ˆï¼ˆæŽ¨èï¼‰

```
IoTå®žæ—¶æ•°æ®: Kafka
åŽ†å²æ•°æ®: InfluxDB
é…ç½®æ•°æ®: PostgreSQL
ä¸šåŠ¡æ•°æ®: PostgreSQL
ç¼“å­˜: Redis
æ—¥å¿—: ELK Stack (Elasticsearch + Logstash + Kibana)
ç›‘æŽ§: Prometheus + Grafana
```

---

## å…­ã€æ€»ç»“

### å­˜å‚¨æ–¹æ¡ˆå†³ç­–è¡¨

| æ•°æ®ç±»åž‹ | æŽ¨èæ–¹æ¡ˆ | ç†ç”± | æ›¿ä»£æ–¹æ¡ˆ |
|---------|---------|------|---------|
| **IoTå®žæ—¶æ•°æ®** | **Kafka** | æµå¼ã€é«˜åžå | RabbitMQ |
| **ä¼ æ„Ÿå™¨åŽ†å²æ•°æ®** | **InfluxDB** | æ—¶åºä¼˜åŒ– | TimescaleDB |
| **å·¥è‰ºè§„èŒƒé…ç½®** | **PostgreSQL** | å…³ç³»åž‹ã€ç‰ˆæœ¬ç®¡ç† | MySQL |
| **ä¸šåŠ¡æ•°æ®** | **PostgreSQL** | å…³ç³»åž‹ã€ACID | MySQL |
| **ç¼“å­˜** | **Redis** | å†…å­˜ã€å¿«é€Ÿ | - |

### å…³é”®è®¾è®¡

1. **æ•°æ®åˆ†å±‚**ï¼š
   - å®žæ—¶å±‚ï¼ˆKafkaï¼‰
   - åŽ†å²å±‚ï¼ˆInfluxDBï¼‰
   - é…ç½®å±‚ï¼ˆPostgreSQLï¼‰
   - ä¸šåŠ¡å±‚ï¼ˆPostgreSQLï¼‰
   - ç¼“å­˜å±‚ï¼ˆRedisï¼‰

2. **æ•°æ®æµè½¬**ï¼š
   - IoTæ•°æ® â†’ Kafka â†’ InfluxDB
   - ç”¨æˆ·è¯·æ±‚ â†’ ä»ŽInfluxDBè¯»å–åŽ†å²æ•°æ® + ä»ŽPostgreSQLè¯»å–è§„èŒƒ â†’ æ‰§è¡Œæ£€éªŒ â†’ å­˜å‚¨ç»“æžœåˆ°PostgreSQL

3. **æŸ¥è¯¢æ¨¡å¼**ï¼š
   - æ—¶åºæŸ¥è¯¢ â†’ InfluxDB
   - å…³ç³»æŸ¥è¯¢ â†’ PostgreSQL
   - çƒ­æ•°æ®æŸ¥è¯¢ â†’ Redisç¼“å­˜

